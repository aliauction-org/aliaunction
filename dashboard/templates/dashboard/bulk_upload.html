{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container" style="padding: 2rem;">
    <div style="max-width: 800px; margin: 0 auto;">

        <!-- Header -->
        <div style="margin-bottom: 2rem;">
            <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">Bulk Upload Auctions</h1>
            <p style="color: var(--text-secondary);">Upload a CSV file to create multiple auctions at once.</p>
        </div>

        <!-- Messages -->
        {% if messages %}
        <div style="margin-bottom: 2rem;">
            {% for message in messages %}
            <div class="alert"
                style="padding: 1rem; margin-bottom: 0.5rem; border-radius: var(--radius-md); background: {% if message.tags == 'error' %}#fef2f2{% elif message.tags == 'warning' %}#fffbeb{% else %}#f0fdf4{% endif %}; color: {% if message.tags == 'error' %}#dc2626{% elif message.tags == 'warning' %}#d97706{% else %}#15803d{% endif %}; border: 1px solid {% if message.tags == 'error' %}#fecaca{% elif message.tags == 'warning' %}#fde68a{% else %}#bbf7d0{% endif %};">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Upload Form -->
        <div class="card" style="margin-bottom: 2rem;">
            <div class="card-body" style="padding: 2rem;">
                <h2 style="font-size: 1.3rem; margin-bottom: 1.5rem;">Upload CSV File</h2>

                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}

                    <div class="form-group" style="margin-bottom: 1.5rem;">
                        <label for="csv_file" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Select
                            CSV File</label>
                        <input type="file" name="csv_file" id="csv_file" accept=".csv" required
                            style="width: 100%; padding: 0.75rem; border: 2px dashed var(--border-color); border-radius: var(--radius-md); background: var(--bg-secondary); cursor: pointer;">
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1rem;">
                        Upload and Create Auctions
                    </button>
                </form>
            </div>
        </div>

        <!-- CSV Format Guide -->
        <div class="card" style="margin-bottom: 2rem;">
            <div class="card-body" style="padding: 2rem;">
                <h2 style="font-size: 1.3rem; margin-bottom: 1rem;">CSV Format Guide</h2>

                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                    Your CSV file should have the following columns:
                </p>

                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                        <thead>
                            <tr style="background: var(--bg-secondary);">
                                <th
                                    style="padding: 0.75rem; text-align: left; border-bottom: 2px solid var(--border-color);">
                                    Column</th>
                                <th
                                    style="padding: 0.75rem; text-align: left; border-bottom: 2px solid var(--border-color);">
                                    Required</th>
                                <th
                                    style="padding: 0.75rem; text-align: left; border-bottom: 2px solid var(--border-color);">
                                    Format</th>
                                <th
                                    style="padding: 0.75rem; text-align: left; border-bottom: 2px solid var(--border-color);">
                                    Example</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 0.75rem; border-bottom: 1px solid var(--border-color);">
                                    <code>title</code></td>
                                <td style="padding: 0.75rem; border-bottom: 1px solid var(--border-color);">Yes</td>
                                <td style="padding: 0.75rem; border-bottom: 1px solid var(--border-color);">Text</td>
                                <td style="padding: 0.75rem; border-bottom: 1px solid var(--border-color);">Vintage
                                    Watch</td>
                            </tr>
                            <tr>
                                <td style="padding: 0.75rem; border-bottom: 1px solid var(--border-color);">
                                    <code>description</code></td>
                                <td style="padding: 0.75rem; border-bottom: 1px solid var(--border-color);">Yes</td>
                                <td style="padding: 0.75rem; border-bottom: 1px solid var(--border-color);">Text</td>
                                <td style="padding: 0.75rem; border-bottom: 1px solid var(--border-color);">Beautiful
                                    vintage watch...</td>
                            </tr>
                            <tr>
                                <td style="padding: 0.75rem; border-bottom: 1px solid var(--border-color);">
                                    <code>starting_price</code></td>
                                <td style="padding: 0.75rem; border-bottom: 1px solid var(--border-color);">Yes</td>
                                <td style="padding: 0.75rem; border-bottom: 1px solid var(--border-color);">Number</td>
                                <td style="padding: 0.75rem; border-bottom: 1px solid var(--border-color);">5000</td>
                            </tr>
                            <tr>
                                <td style="padding: 0.75rem; border-bottom: 1px solid var(--border-color);">
                                    <code>end_time</code></td>
                                <td style="padding: 0.75rem; border-bottom: 1px solid var(--border-color);">Yes</td>
                                <td style="padding: 0.75rem; border-bottom: 1px solid var(--border-color);">YYYY-MM-DD
                                    HH:MM</td>
                                <td style="padding: 0.75rem; border-bottom: 1px solid var(--border-color);">2026-02-01
                                    18:00</td>
                            </tr>
                            <tr>
                                <td style="padding: 0.75rem; border-bottom: 1px solid var(--border-color);">
                                    <code>category_slug</code></td>
                                <td style="padding: 0.75rem; border-bottom: 1px solid var(--border-color);">No</td>
                                <td style="padding: 0.75rem; border-bottom: 1px solid var(--border-color);">Text (slug)
                                </td>
                                <td style="padding: 0.75rem; border-bottom: 1px solid var(--border-color);">watches</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Sample CSV -->
        <div class="card">
            <div class="card-body" style="padding: 2rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2 style="font-size: 1.3rem; margin: 0;">Sample CSV</h2>
                    <button onclick="downloadSampleCSV()" class="btn btn-outline btn-sm">Download Sample</button>
                </div>

                <pre
                    style="background: var(--bg-secondary); padding: 1rem; border-radius: var(--radius-md); overflow-x: auto; font-size: 0.85rem; line-height: 1.5;">{{ sample_csv }}</pre>
            </div>
        </div>

        <!-- Back Link -->
        <div style="margin-top: 2rem; text-align: center;">
            <a href="{% url 'dashboard_home' %}" style="color: var(--accent-color);">‚Üê Back to Dashboard</a>
        </div>
    </div>
</div>

<script>
    function downloadSampleCSV() {
        const csvContent = `{{ sample_csv|escapejs }}`;
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', 'auction_upload_template.csv');
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
</script>
{% endblock %}