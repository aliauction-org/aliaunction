{% extends "base.html" %}
{% load static %}

{% block content %}
<div style="max-width:800px;margin:2rem auto;">

  <h1>Create New Auction</h1>

  {% if messages %}
  {% for message in messages %}
  <div>{{ message }}</div>
  {% endfor %}
  {% endif %}

  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    {% for field in form %}
    <div style="margin-bottom:1rem;">

      <label for="{{ field.id_for_label }}">
        {{ field.label }}
        {% if field.field.required %}
        <span style="color:red">*</span>
        {% endif %}
      </label>

      {% if field.name == "image" %}

      <div style="
    border:2px dashed var(--border-color);
    border-radius:12px;
    padding:1.8rem;
    text-align:center;
    background:var(--bg-secondary);
    cursor:pointer;
    transition:all 0.2s ease;
  " onclick="document.getElementById('{{ field.id_for_label }}').click();">

        <div style="font-size:2rem; margin-bottom:0.5rem;">üì∑</div>

        <div style="font-weight:600; margin-bottom:0.25rem;">
          Upload product image
        </div>

        <div style="font-size:0.85rem; color:var(--text-secondary);">
          JPG, PNG or WEBP - max 5MB
        </div>

        <input type="file" name="{{ field.name }}" id="{{ field.id_for_label }}" accept="image/*" style="display:none;">
      </div>

      {% elif field.name == "end_time" %}

      <div style="display:flex; flex-direction:column; gap:0.5rem;">

        <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">

          <input type="text" maxlength="2" placeholder="DD" oninput="autoJump(this, 'month')" id="day"
            style="width:60px; padding:0.6rem; text-align:center;">

          <span>/</span>

          <input type="text" maxlength="2" placeholder="MM" oninput="autoJump(this, 'year')" id="month"
            style="width:60px; padding:0.6rem; text-align:center;">

          <span>/</span>

          <input type="text" maxlength="4" placeholder="YYYY" oninput="autoJump(this, 'hour')" id="year"
            style="width:80px; padding:0.6rem; text-align:center;">

          <span style="margin-left:0.5rem;">‚è∞</span>

          <input type="text" maxlength="2" placeholder="HH" oninput="autoJump(this, 'minute')" id="hour"
            style="width:60px; padding:0.6rem; text-align:center;">

          <span>:</span>

          <input type="text" maxlength="2" placeholder="MM" oninput="updateHiddenDateTime()" id="minute"
            style="width:60px; padding:0.6rem; text-align:center;">

        </div>

        <small style="color:var(--text-secondary);">
          Day / Month / Year - 24 hour format
        </small>

        <!-- Hidden real field sent to Django -->
        <input type="hidden" name="{{ field.name }}" id="{{ field.id_for_label }}">

      </div>



      {% elif field.name == "starting_bid" or field.name == "buy_now" %}

      <div style="position:relative;">
        <span style="position:absolute;left:6px;top:50%;transform:translateY(-50%)">‚Çπ</span>
        <input type="{{ field.field.widget.input_type|default:'text' }}" name="{{ field.name }}"
          id="{{ field.id_for_label }}" value="{{ field.value|default:'' }}" style="padding-left:1.5rem;">
      </div>

      {% else %}

      <input type="{{ field.field.widget.input_type|default:'text' }}" name="{{ field.name }}"
        id="{{ field.id_for_label }}" value="{{ field.value|default:'' }}">

      {% endif %}

      {% if field.help_text %}
      <small>{{ field.help_text|safe }}</small>
      {% endif %}

      {% if field.errors %}
      <div style="color:red">{{ field.errors.0 }}</div>
      {% endif %}

    </div>
    {% endfor %}

    <div style="margin-top:2rem; display:flex; gap:1rem;">
      <button type="submit" style="
      flex:1;
      padding:0.9rem 1.2rem;
      background:#131314;
      color:white;
      border:none;
      border-radius:10px;
      font-size:1rem;
      font-weight:600;
      cursor:pointer;
      transition:background 0.2s;
    " onmouseover="this.style.background='#1e40af'" onmouseout="this.style.background='#2563eb'">
        Create Auction
      </button>

      <a href="{% url 'dashboard_home' %}" style="
      padding:0.9rem 1.5rem;
      border:1px solid red;
      border-radius:10px;
      font-size:1rem;
      text-decoration:none;
      color:var(--text-main);
      display:flex;
      align-items:center;
      justify-content:center;
    ">
        Cancel
      </a>
    </div>


  </form>
</div>


<script>
  function autoJump(current, nextId) {
    if (current.value.length === current.maxLength) {
      document.getElementById(nextId).focus();
    }
    updateHiddenDateTime();
  }

  function updateHiddenDateTime() {
    const d = document.getElementById('day').value;
    const m = document.getElementById('month').value;
    const y = document.getElementById('year').value;
    const h = document.getElementById('hour').value;
    const min = document.getElementById('minute').value;

    if (d && m && y && h && min) {
      document.getElementById('{{ field.id_for_label }}').value =
        `${y}-${m.padStart(2, '0')}-${d.padStart(2, '0')}T${h.padStart(2, '0')}:${min.padStart(2, '0')}`;
    }
  }
</script>

{% endblock %}