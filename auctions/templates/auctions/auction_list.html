{% extends 'base.html' %}
{% load indian_format %}
{% load static %}

{% block content %}
<div class="container" style="padding: 2rem 0;">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <div>
      <h1 style="font-size: 2rem; color: var(--text-main); margin-bottom: 0.5rem;">All Auctions</h1>
      <p style="color: var(--text-secondary);">Browse our collection of premium items</p>
    </div>

    {% if user.is_authenticated %}
    <a href="{% url 'create_auction' %}" class="btn btn-primary">
      <span style="font-weight: bold; margin-right: 0.5rem;">+</span> Create Auction
    </a>
    {% endif %}
  </div>

  {% if auctions %}
  <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 2rem;">
    {% for auction in auctions %}
    <div class="card">
      <a href="{% url 'auction_detail' auction.id %}" style="text-decoration: none; color: inherit; display: block;">
        <!-- Image Aspect Ratio Wrapper -->
        <div style="aspect-ratio: 4/3; overflow: hidden; background-color: #f1f5f9; position: relative;">
          {% if auction.image %}
          <img src="{{ auction.image.url }}" alt="{{ auction.title }}"
            style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease;">
          {% else %}
          <div
            style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--text-muted);">
            No Image
          </div>
          {% endif %}

          {% if auction.category %}
          <div
            style="position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.6); color: white; padding: 4px 8px; font-size: 0.75rem; border-radius: 4px; backdrop-filter: blur(4px);">
            {{ auction.category.name }}
          </div>
          {% endif %}

          {% if auction.is_featured %}
          <div
            style="position: absolute; top: 10px; right: 10px; background: var(--accent-color); color: white; padding: 4px 8px; font-size: 0.75rem; font-weight: 600; border-radius: 4px;">
            FEATURED
          </div>
          {% endif %}
        </div>

        <div class="card-body">
          <h3 style="font-size: 1.1rem; margin-bottom: 0.5rem; line-height: 1.4; min-height: 3em;">
            {{ auction.title|truncatechars:50 }}
          </h3>

          <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-top: 1rem;">
            <div>
              <div style="font-size: 0.85rem; color: var(--text-secondary);">Current Bid</div>
              <div style="font-size: 1.25rem; font-weight: 700; color: var(--text-main);">
                â‚¹{{ auction.current_price|indian_format }}
              </div>
            </div>

            <div style="text-align: right;">
              <div style="font-size: 0.85rem; color: var(--text-secondary);">Ends In</div>
              <div style="font-size: 0.95rem; font-weight: 500; font-variant-numeric: tabular-nums;">
                {% if auction.end_time|date:'U' < now|date:'U' %} <span style="color: var(--danger-color);">Ended</span>
                  {% else %}
                  {{ auction.end_time|timeuntil }}
                  {% endif %}
              </div>
            </div>
          </div>

          {% if user == auction.seller or user.is_staff %}
          <div
            style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
            <span style="font-size: 0.8rem; color: var(--text-muted);">Status: {{ auction.workflow.status }}</span>

            {% if auction.workflow.status == "DRAFT" %}
            <form method="post" action="{% url 'submit_auction' auction.id %}">
              {% csrf_token %}
              <button type="submit" class="btn btn-primary btn-sm"
                style="font-size: 0.8rem; padding: 0.25rem 0.75rem;">Submit</button>
            </form>
            {% endif %}
          </div>
          {% endif %}
        </div>
      </a>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div
    style="text-align: center; padding: 5rem 1rem; background: white; border-radius: var(--radius-lg); border: 1px solid var(--border-color);">
    <div style="font-size: 3rem; margin-bottom: 1rem;">ðŸ“­</div>
    <h3 style="font-size: 1.5rem; color: var(--text-main); margin-bottom: 0.5rem;">No active auctions</h3>
    <p style="color: var(--text-secondary); margin-bottom: 2rem;">Check back later or start your own auction.</p>
    {% if user.is_authenticated %}
    <a href="{% url 'create_auction' %}" class="btn btn-primary">Create Auction</a>
    {% endif %}
  </div>
  {% endif %}
</div>
{% endblock %}