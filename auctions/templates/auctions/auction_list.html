{% extends 'base.html' %}
{% load indian_format %}
{% block content %}
{% if user.is_authenticated %}
<div style="display:flex;justify-content:center;margin-bottom:2.5rem;">
  <a href="{% url 'create_auction' %}" class="card-btn"
    style="display:flex;align-items:center;gap:0.7rem;font-size:1.35rem;padding:1rem 2.2rem;background:linear-gradient(90deg,#3a8dde,#7ecbff);color:#fff;border-radius:2rem;font-weight:700;box-shadow:0 2px 8px 0 rgba(49,130,206,0.10);text-decoration:none;transition:background 0.2s,box-shadow 0.2s;">
    <span style="font-size:2.1rem;line-height:1;">+</span> Create New Auction
  </a>
</div>
{% endif %}
{% if auctions %}
<style>
  .card {
    position: relative;
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  .card .title {
    font-size: 1.2rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
    color: #23284a;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .card .current-bid {
    color: #10b981;
    font-weight: 800;
    font-size: 1.2rem;
    margin-top: auto;
  }

  .card .timer {
    font-size: 0.9rem;
    color: #666;
    margin-top: 0.5rem;
  }

  .card img {
    width: 100%;
    height: 220px;
    object-fit: cover;
    border-radius: 8px;
    margin-bottom: 1rem;
    transition: transform 0.3s;
  }

  .card:hover img {
    transform: scale(1.02);
  }

  .category-badge {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(0, 0, 0, 0.6);
    color: white;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.75rem;
  }

  .featured-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #ffd700;
    color: #000;
    padding: 2px 10px;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: bold;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
  }
</style>

<div class="auction-cards-grid"
  style="width:100%;display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:2rem;justify-items:center;margin:0 auto;max-width:1200px;">
  {% for auction in auctions %}
  <div class="card" style="width:100%;max-width:350px;">
    {% if auction.category %}
    <span class="category-badge">{{ auction.category.name }}</span>
    {% endif %}

    {% if auction.is_featured %}
    <span class="featured-badge">Featured</span>
    {% endif %}

    {% if auction.image %}
    <img src="{{ auction.image.url }}" alt="{{ auction.title }}" />
    {% else %}
    <img src="https://via.placeholder.com/180x180/3a8dde/ffffff?text=No+Image" alt="No Image" />
    {% endif %}

    <div class="title" title="{{ auction.title }}">{{ auction.title }}</div>
    <div class="current-bid">INR {{ auction.current_price|indian_currency }}</div>

    <div class="timer">
      {% if auction.end_time|date:'U' < now|date:'U' %} <span style="color: #e53e3e; font-weight: bold;">Ended</span>
        {% else %}
        Ends: {{ auction.end_time|date:'M d, h:i a' }}
        {% endif %}

        {% if auction.workflow.status == "DRAFT" %}
        <form method="post" action="{% url 'submit_auction' auction.id %}" style="margin-top:0.5rem;">
          {% csrf_token %}
          <button type="submit"
            style="background:#e2e8f0; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">Submit for
            Approval</button>
        </form>
        {% elif auction.workflow.status == "PENDING" %}
        <p style="color:#d69e2e; font-size:0.8rem; margin:0;">⚠ Awaiting Approval</p>
        {% elif auction.workflow.status == "REJECTED" %}
        <p style="color:#e53e3e; font-size:0.8rem; margin:0;">⚠ Rejected</p>
        {% endif %}
    </div>

    <a href="{% url 'auction_detail' auction.id %}" class="card-btn"
      style="margin-top:1rem; display:block; text-align:center; text-decoration:none;">View Details</a>
  </div>
  {% endfor %}
</div>
{% else %}
<div class="card">No active auctions.</div>
{% endif %}
{% endblock %}